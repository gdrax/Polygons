<!DOCTYPE html>
<html>
<head>
	<title>test</title>
</head>
<style type="text/css">
	html, body {
			width: 100%;
			height: 100%;
			margin: 0px;
			overflow: hidden;
	}
	canvas {
		width: 100%;
		height: 100%;
		margin-bottom: 0px;
	}
</style>
<body>
<canvas id="canvas" onmousemove="updateMouseCoordinates(event)" onkeypress="keyPressed(event)" onclick="mouseClick()"> </canvas>
<script type="text/javascript">
	canvas = document.getElementById("canvas");
	ctx = canvas.getContext("2d");

	canvas.width = window.innerWidth;
	canvas.height = window.innerHeight;

	window.onresize = function resize() {
		canvas.width = window.innerWidth;
		canvas.height = window.innerHeight;
		changeGameState(gameState);
	}

	//TODO: make unique object for writings inside a rectangle

	var mouseX = -1;
	var mouseY = -1;
	var gameState = null;
	var keyPressed;
	var title = null;
	var titleRect = null;
	var levelNameRect = null;
	var levelRect = null;
	var levelNumber = 1;
	var currentLevel = null;

	changeGameState("opening");

	/*
	cambia lo stato del gioco
	*/
	function changeGameState(newState) {
		gameState = newState;
		clearArea();
		initializeObjects();
		startAnimation();
	}

	/*
	pulisce l'area di gioco
	*/
	function clearArea() {
		ctx.clearRect(0, 0, canvas.width, canvas.height);
		ctx.fillStyle = 'rgb(10, 10, 10)'
		ctx.fillRect(0, 0, canvas.width, canvas.height);
	}

	/*
	disegna l'area e gli elementi di gioco
	*/
	function drawArea() {
		clearArea();
		switch (gameState) {
			case "opening":
				var titleX = canvas.width*7/17;
				var titleY = canvas.height*3/5;
				var rectX = titleX-title.size/10;
				var rectY = titleY-title.size;
				var lights = mouseInRectangle(titleRect.width, titleRect.height, rectX, rectY);
				title.draw(titleX, titleY, lights, "Serif");
				titleRect.draw(rectX, rectY);
				break;
			case "levels":
				var levelNameX = canvas.width*15/34;
				var levelNameY = canvas.height*4/5;
				var rectX = levelNameX-levelName.size/10;
				var rectY = levelNameY-levelName.size;
				var lights = mouseInRectangle(levelNameRect.width, levelNameRect.height, rectX, rectY);
				levelName.draw(levelNameX,  levelNameY, lights, "Serif");
				levelNameRect.draw(rectX, rectY);
				levelRect.draw(canvas.width/6, canvas.width/8);
				break;
			case "playing": break;
		}
	}

	/*
	inizializza gli oggetti
	*/
	function initializeObjects() {
		switch (gameState) {
			case "opening":
				title = new neonString(new Color(255, 255, 255), new Color(0, 255, 0), canvas.height/20, "Start game");
				titleRect = new roundRectangle(ctx.measureText(title.text).width*title.size/10.8, title.size*1.5, new Color(0, 255, 0));
				break;
			case "levels":
				currentLevel = "Level "+levelNumber;
				levelName = new neonString(new Color(255, 255, 255), new Color(255, 255, 0), canvas.height/20, currentLevel);
				//TODO: rettangolo lunghissimo quando si cambia stato
				levelNameRect = new roundRectangle(ctx.measureText(levelName.text).width*levelName.size/10, levelName.size*1.5, new Color(255, 255, 0));
				levelRect = new roundRectangle(canvas.width*2/3, canvas.height*1/2, new Color(255, 255, 0));
				break;
			case "playing": break;
		}
	}

	/*
	imposta i listener per mouse e tastiera
	*/
	function startAnimation() {
		switch (gameState) {
			case "opening":
				setInterval(drawArea, 20);
				break;
			case "levels":
				setInterval(drawArea, 20);
				break;
			case "playing": break;
		}
	}


	function roundRectangle(width, height, color) {
		this.width = width;
		this.height = height;
		this.color = color.makeColor(1);
		this.radius = 10;
		this.x = null;
		this.y = null;

		this.draw = function(x, y) {
			this.x = x;
			this.y = y;
			ctx.beginPath();
			ctx.moveTo(x + this.radius, y);
			ctx.lineTo(x + this.width - this.radius, y);
			ctx.quadraticCurveTo(x + this.width, y, x + this.width, y + this.radius);
			ctx.lineTo(x + this.width, y + this.height - this.radius);
			ctx.quadraticCurveTo(x + this.width, y + this.height, x + this.width - this.radius, y + this.height);
			ctx.lineTo(x + this.radius, y + this.height);
			ctx.quadraticCurveTo(x, y + this.height, x, y + this.height - this.radius);
			ctx.lineTo(x, y + this.radius);
			ctx.quadraticCurveTo(x, y, x + this.radius, y);
			ctx.closePath();
			ctx.strokeStyle = this.color;
			ctx.stroke();
		}
	}

	/*
	oggetto per generare colori
	*/
	function Color(red, green, blue) {
		this.red = red;
		this.green = green;
		this.blue = blue;
		this.hex = red.toString(16)+green.toString(16)+blue.toString(16);
		this.color = "rgba(0, 0, 0, 0)";

		this.makeColor = function(opacity) {
			this.color = "rgba("+red+", "+green+", "+blue+", "+opacity+")";
			return this.color;
		}

		this.makeHexColor = function() {
			return "#"+this.hex;
		}
	}

	/*
	stringa con effetto neon
	*/
	function neonString(color, shadowColor, size, text) {
		this.color = color.makeColor(1);
		this.shadowColor = shadowColor.makeColor(1);
		this.text = text;
		this.x = null;
		this.y = null;
		this.size = size;

		this.draw = function(x, y, lights, font) {
			this.x = x;
			this.y = y;
			ctx.font = this.size+"px "+font;
			ctx.shadowBlur = 10;
			ctx.shadowColor = this.shadowColor;
			ctx.shadowOffsetX = this.size/100;
			ctx.shadowOffsetY = this.size/100;
			if (lights) {
				//this.drawLight(x-this.size/600, y-this.size/600);
				//this.drawLight(x+this.size/1200, y+this.size/1200);
				this.drawLight(x-this.size/1200, y+this.size/1200);
				this.drawLight(x+this.size/1200, y-this.size/1200);
			}
			ctx.strokeStyle = this.color;
			ctx.strokeText(this.text, x, y);
		}

		this.drawLight = function(x, y) {
			ctx.shadowColor = this.shadowColor;
			ctx.strokeStyle = this.shadowColor;
			ctx.strokeText(this.text, x, y);
		}
	}

	/*
	salva l'ultimo tasto premuto
	*/
	function keyPressed(event) {
		keyPressed = event.keyCode();
	}

	/*
	aggiorna la posizione del muose quando si muove
	*/
	function updateMouseCoordinates(event) {
		mouseX = event.clientX;
		mouseY = event.clientY;
	}

	function mouseClick() {
		switch(gameState) {
			case "opening":
				if (mouseInRectangle(titleRect.width, titleRect.height, titleRect.x, titleRect.y)) {
					gameState = "levels";
					changeGameState("levels");
				}
			break;
			case "levels":
				break;
			case "playing":
				break
		}
	}

	function mouseInRectangle(width, height, x, y) {
		if (mouseX >= x && mouseX <= x + width && mouseY >= y && mouseY <= y + height) {
			return true;
		}
		else
			return false;
	}

</script>
</body>
</html>
